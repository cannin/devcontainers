# Use CUDA 12.9 + cuDNN with full developer toolchain + runtime libs
FROM nvidia/cuda:12.9.1-cudnn-devel-ubuntu24.04

ENV DEBIAN_FRONTEND=noninteractive

# Install general tools + build dependencies + python + git, etc.
RUN apt-get update && apt-get install -y --no-install-recommends \
      build-essential \
      cmake \
      less \
      sudo \
      man-db \
      ripgrep \
      fzf \
      unzip \
      gnupg2 \
      jq \
      python3-pip \
      python3-setuptools \
      python3-wheel \
      python3-dev \
      wget \
      curl \
      gh \
      git \
      nano \
      ncdu \
      htop \
      screen \
      magic-wormhole \
      micro \
      fontconfig \
      fonts-dejavu-core \
      libjpeg-dev \
      zlib1g-dev \
      libtiff-dev \
      libfreetype6-dev \
      liblcms2-dev \
      libwebp-dev \
      libopenjp2-7-dev \
    && rm -rf /var/lib/apt/lists/*

# (Optional) symlink python -> python3
RUN ln -s /usr/bin/python3 /usr/bin/python

# Install uv (standalone Rust-based Python tool manager)
RUN curl -LsSf https://astral.sh/uv/install.sh | sh

# Install Node.js & Codex
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
    && apt-get install -y nodejs \
    && npm install -g @openai/codex@latest \
    && rm -rf /var/lib/apt/lists/*

# Create workspace and config directories and set permissions
RUN mkdir -p /workspace /root/.codex

WORKDIR /workspace
